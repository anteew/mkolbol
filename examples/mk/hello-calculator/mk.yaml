# Hello Calculator — HTTP Variant
#
# A tiny HTTP calculator server wired through mkolbol using ExternalProcess.
# Endpoints:
#  - /add?a=5&b=3       → {"result":8}
#  - /subtract?a=10&b=4 → {"result":6}
#
# Run:
#   node dist/scripts/mkctl.js run --file examples/mk/hello-calculator/mk.yaml --duration 10
# Test in another shell:
#   curl 'http://localhost:4000/add?a=2&b=3'
#   curl 'http://localhost:4000/subtract?a=10&b=7'

nodes:
  - id: calc
    module: ExternalProcess
    params:
      command: node
      args:
        - -e
        - |
          const http=require('http');
          const server=http.createServer((req,res)=>{
            const u=new URL(req.url,'http://localhost:4000');
            const a=parseFloat(u.searchParams.get('a')||'0');
            const b=parseFloat(u.searchParams.get('b')||'0');
            let result;
            if(u.pathname==='/add') result=a+b;
            else if(u.pathname==='/subtract') result=a-b;
            else { res.statusCode=404; return res.end('not found'); }
            console.log(`[calc] ${u.pathname}?a=${a}&b=${b} -> ${result}`);
            res.setHeader('content-type','application/json');
            res.end(JSON.stringify({result}));
          });
          server.listen(4000,()=>console.log('Calculator listening on http://localhost:4000'));
      ioMode: stdio
      restart: never

  - id: console
    module: ConsoleSink
    params:
      prefix: "[hello-calculator]"

connections:
  - from: calc.output
    to: console.input
