{
  "ampcode": "v1",
  "waves": [
    {
      "id": "P27-TLS",
      "parallel": false,
      "tasks": ["D2701", "D2702", "D2703"]
    }
  ],
  "branch": "mkolbol-net-p27-tls",
  "tasks": [
    {
      "id": "D2701",
      "agent": "devex",
      "title": "TLS/mTLS support: tcp+wss flags; docs + examples",
      "why": "Secure transport for operators; start with flags and recipes.",
      "allowedFiles": [
        "scripts/mkctl.ts",
        "src/pipes/adapters/TCPPipe.ts",
        "src/pipes/adapters/WebSocketPipe.ts",
        "docs/devex/network-quickstart.md",
        "docs/devex/remote-host-setup.md"
      ],
      "verify": ["npm run build", "npm run test:ci"],
      "deliverables": ["patches/DIFF_D2701_tls-flags-docs.patch"]
    },
    {
      "id": "D2702",
      "agent": "devex",
      "title": "mTLS demo with self-signed CAs + acceptance smoke (non-gating)",
      "allowedFiles": ["examples/network/tls-demo/**", ".github/workflows/tests.yml"],
      "verify": ["npm run ci:local:fast"],
      "deliverables": ["patches/DIFF_D2702_mtls-acceptance.patch"]
    },
    {
      "id": "D2703",
      "agent": "devex",
      "title": "Security guide: auth patterns, SSH tunnel, wss, TLS pitfalls",
      "allowedFiles": ["docs/devex/security-guide.md", "README.md"],
      "verify": ["npm run build"],
      "deliverables": ["patches/DIFF_D2703_security-guide.patch"]
    }
  ],
  "branch_instructions": [
    "IMPORTANT: Work only on mkolbol-net-p27-tls.",
    "Logs: write JSON Lines to devex.log (devex schema).",
    "No breaking behavior; document flags and defaults clearly."
  ],
  "instructions": {
    "overview": "Add TLS/wss flags and docs; demonstrate mTLS and document security patterns.",
    "expectations": [
      "Write JSONL log entries using the devex log schema.",
      "Do not introduce breaking changes; document flags and defaults clearly.",
      "Run verify commands and include deliverable patches."
    ],
    "briefing": "Fail-fast ESLint fix dry-run runs first on staged JS/TS files; commit blocks if fixable or error findings are present. Fix with: npx eslint <staged-files> --fix, then re-stage and commit. One-time override: SKIP_ESLINT_DRYRUN=1. Prettier auto-formats staged files; lint is warn-only; local fast CI runs on pre-push.",
    "logging": {
      "log_file": "devex.log",
      "schema": "agent_template/log_templates/devex_sprint_log.schema.json",
      "example": "agent_template/log_templates/devex_sprint_log.example.jsonl"
    },
    "hooks": {
      "eslint_dryrun": {
        "summary": "Fail‑fast ESLint fix dry‑run runs first; override with SKIP_ESLINT_DRYRUN=1 to bypass once.",
        "example": "agent_template/examples/precommit-eslint-dryrun.md"
      }
    },
    "deliverables_global": ["patches/*.patch", "tests updated and passing", "docs updated"]
  }
}
